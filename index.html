<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTG Card Price Sorter</title>
    <style>
        :root {
            --bg-primary: #00ffff;
            --bg-secondary: #ff00ff;
            --bg-tertiary: #ffff00;
            --accent: #ff0000;
            --accent-hover: #ff6600;
            --text-primary: #000000;
            --text-secondary: #0000ff;
            --border: #000000;
            --success: #00ff00;
            --warning: #ffff00;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', cursive;
            background: #808080 url('data:image/svg+xml,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><rect fill="%23666666" width="10" height="10"/><rect fill="%23999999" x="10" width="10" height="10"/><rect fill="%23999999" y="10" width="10" height="10"/><rect fill="%23666666" x="10" y="10" width="10" height="10"/></svg>');
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #c0c0c0;
            border: 5px outset #ffffff;
            padding: 2rem;
            box-shadow: 10px 10px 0px #000000;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-size: 400% 400%;
            animation: rainbow 3s linear infinite;
            padding: 1rem;
            border: 3px solid #000000;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            color: #ffff00;
            text-shadow: 3px 3px 0px #ff00ff, 6px 6px 0px #00ffff;
            font-weight: bold;
            letter-spacing: 0.1em;
            animation: blink 1s infinite;
        }

        .subtitle {
            color: #ffffff;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 2px 2px 0px #000000;
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: #00ffff;
            border: 5px ridge #ffffff;
            box-shadow: 5px 5px 0px #000000;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            background: #ffff00;
            padding: 1rem;
            border: 3px groove #000000;
        }

        label {
            font-size: 1rem;
            color: #ff0000;
            font-weight: bold;
            text-transform: uppercase;
        }

        input[type="number"], select {
            padding: 0.75rem 1rem;
            border: 3px inset #ffffff;
            background: #ffffff;
            color: #000000;
            font-size: 1rem;
            min-width: 150px;
            font-family: 'Comic Sans MS', cursive;
        }

        input[type="number"]:focus, select:focus {
            outline: 3px solid #ff00ff;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: 4px outset #ffffff;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            align-self: flex-end;
            font-family: 'Comic Sans MS', cursive;
            text-transform: uppercase;
            box-shadow: 4px 4px 0px #000000;
        }

        .btn-primary {
            background: linear-gradient(180deg, #ff00ff 0%, #ff0000 50%, #ff00ff 100%);
            color: #ffff00;
            text-shadow: 2px 2px 0px #000000;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(180deg, #ff0000 0%, #ff00ff 50%, #ff0000 100%);
            border-style: inset;
        }

        .btn-primary:active {
            border-style: inset;
            box-shadow: inset 2px 2px 5px #000000;
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(180deg, #00ffff 0%, #0000ff 50%, #00ffff 100%);
            color: #ffffff;
            text-shadow: 1px 1px 0px #000000;
        }

        .btn-secondary:hover {
            background: linear-gradient(180deg, #0000ff 0%, #00ffff 50%, #0000ff 100%);
            border-style: inset;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: #c0c0c0;
            border: 5px ridge #ffffff;
            overflow: hidden;
            box-shadow: 5px 5px 0px #000000;
        }

        .panel-header {
            padding: 1rem 1.5rem;
            background: linear-gradient(180deg, #0000ff 0%, #000080 100%);
            border-bottom: 3px solid #000000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 2px 2px 0px #000000;
            text-transform: uppercase;
        }

        .panel-body {
            padding: 1rem;
            background: #ffffff;
        }

        textarea {
            width: 100%;
            height: 400px;
            padding: 1rem;
            border: 4px inset #808080;
            background: #ffff00;
            color: #000000;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            resize: vertical;
            line-height: 1.5;
        }

        textarea:focus {
            outline: 3px solid #ff00ff;
        }

        textarea::placeholder {
            color: #0000ff;
            font-weight: bold;
        }

        .output-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.5rem 1rem;
            background: linear-gradient(180deg, #00ff00 0%, #008000 100%);
            border: 3px outset #ffffff;
            color: #000000;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            font-family: 'Comic Sans MS', cursive;
            box-shadow: 2px 2px 0px #000000;
        }

        .tab-btn.active {
            background: linear-gradient(180deg, #ff0000 0%, #800000 100%);
            border-style: inset;
            color: #ffff00;
            text-shadow: 1px 1px 0px #000000;
        }

        .tab-btn:hover:not(.active) {
            background: linear-gradient(180deg, #00ffff 0%, #008080 100%);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            padding: 1rem;
            border: 4px outset #ffffff;
            text-align: center;
            box-shadow: 3px 3px 0px #000000;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffff00;
            text-shadow: 2px 2px 0px #000000;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #000000;
            margin-top: 0.25rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .progress-bar {
            height: 20px;
            background: #808080;
            border: 3px inset #ffffff;
            overflow: hidden;
            margin-top: 1rem;
            display: none;
        }

        .progress-bar.active {
            display: block;
        }

        .progress-fill {
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                #00ff00,
                #00ff00 10px,
                #00ffff 10px,
                #00ffff 20px
            );
            transition: width 0.3s ease;
            animation: rainbow 2s linear infinite;
        }

        .status {
            text-align: center;
            padding: 0.75rem;
            color: #0000ff;
            font-size: 1rem;
            font-weight: bold;
        }

        .error {
            color: #ff0000;
            animation: blink 0.5s infinite;
        }

        .copy-btn {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 0.5rem;
            border: 2px solid #000000;
            box-shadow: 1px 1px 0px #000000;
        }

        .badge-below {
            background: #00ff00;
            color: #000000;
        }

        .badge-above {
            background: #ffff00;
            color: #ff0000;
        }

        .badge-notfound {
            background: #ff0000;
            color: #ffffff;
        }

        footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            border: 3px double #000000;
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ffff00, #ff00ff);
            background-size: 200% 200%;
            animation: rainbow 5s linear infinite;
            color: #000000;
            font-size: 0.9rem;
            font-weight: bold;
        }

        footer a {
            color: #0000ff;
            text-decoration: underline;
            font-weight: bold;
        }

        footer a:hover {
            color: #ff0000;
            background: #ffff00;
        }

        .external-link {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            color: #0000ff;
            text-decoration: underline;
            font-size: 0.9rem;
            margin-left: 0.5rem;
            font-weight: bold;
        }

        .external-link:hover {
            color: #ff0000;
            background: #ffff00;
        }

        .external-link::after {
            content: "â†—";
            font-size: 0.9rem;
        }

        .ck-builder-link {
            display: none;
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: #00ffff;
            border: 3px ridge #ffffff;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <marquee behavior="alternate" scrollamount="5" style="font-size: 1.2rem; color: #00ff00; font-weight: bold; text-shadow: 2px 2px 0px #000000;">ðŸŒŸâœ¨ WELCOME TO THE ULTIMATE MTG PRICE SORTER! âœ¨ðŸŒŸ</marquee>
            <h1>MTG Card Price Sorter</h1>
            <p class="subtitle">âš¡ Sort and filter your Magic: The Gathering cards by price! âš¡</p>
            <marquee scrollamount="3" style="font-size: 0.9rem; color: #ffffff; margin-top: 0.5rem;">ðŸ’° Get the BEST deals! ðŸ’Ž Find CHEAP cards! ðŸŽ¯ Build your deck NOW! ðŸ”¥</marquee>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="threshold">Price Threshold ($)</label>
                <input type="number" id="threshold" value="1.00" min="0" step="0.01">
            </div>
            <div class="control-group">
                <label for="source">Price Source</label>
                <select id="source" onchange="updateBuilderLink()">
                    <option value="tcgplayer">TCGPlayer (via Scryfall)</option>
                    <option value="cardkingdom">Card Kingdom</option>
                </select>
                <a href="https://www.tcgplayer.com/massentry" target="_blank" rel="noopener noreferrer" class="external-link" id="tcgBuilderLink">
                    TCGPlayer Mass Entry
                </a>
                <a href="https://www.cardkingdom.com/builder" target="_blank" rel="noopener noreferrer" class="external-link" id="ckBuilderLink" style="display: none;">
                    Card Kingdom Builder
                </a>
            </div>
            <button class="btn btn-primary" id="sortBtn" onclick="processCards()">
                Sort Cards
            </button>
        </div>

        <div class="main-content">
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">Input Cards</span>
                    <button class="btn btn-secondary copy-btn" onclick="loadSample()">Load Sample</button>
                </div>
                <div class="panel-body">
                    <textarea id="inputCards" placeholder="Enter card names, one per line...

Example:
Lightning Bolt
Counterspell
Sol Ring
Black Lotus"></textarea>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">Output</span>
                    <div class="output-tabs">
                        <button class="tab-btn active" data-tab="below" onclick="switchTab('below')">
                            Below <span class="badge badge-below" id="belowCount">0</span>
                        </button>
                        <button class="tab-btn" data-tab="above" onclick="switchTab('above')">
                            Above <span class="badge badge-above" id="aboveCount">0</span>
                        </button>
                        <button class="tab-btn" data-tab="notfound" onclick="switchTab('notfound')">
                            Not Found <span class="badge badge-notfound" id="notFoundCount">0</span>
                        </button>
                        <button class="tab-btn" data-tab="summary" onclick="switchTab('summary')">Summary</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="stats" id="stats" style="display: none;">
                        <div class="stat-card">
                            <div class="stat-value" id="totalCards">0</div>
                            <div class="stat-label">Total Cards</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="belowTotal">$0.00</div>
                            <div class="stat-label">Below Threshold</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="grandTotal">$0.00</div>
                            <div class="stat-label">Grand Total</div>
                        </div>
                    </div>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="status" id="status">Enter cards and click "Sort Cards" to begin</div>
                    <textarea id="outputCards" readonly placeholder="Results will appear here..."></textarea>
                    <div style="margin-top: 0.5rem; text-align: right;">
                        <button class="btn btn-secondary copy-btn" onclick="copyOutput()">Copy to Clipboard</button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>TCGPlayer prices from <a href="https://scryfall.com" target="_blank">Scryfall API</a> | Card Kingdom prices updated hourly</p>
            <p style="margin-top: 0.5rem;">Card Kingdom lookups are instant. TCGPlayer requires individual API calls (~10/sec).</p>
        </footer>
    </div>

    <script>
        // State
        let results = {
            below: [],
            above: [],
            notFound: [],
            all: []
        };
        let currentTab = 'below';
        let currentSource = 'tcgplayer';
        let priceCache = {};
        let ckPricelist = null;
        let ckPricelistUpdated = null;

        // Normalize card name (strip accents for Card Kingdom lookups)
        function normalizeName(name) {
            return name.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase().trim();
        }

        // Load cache from localStorage
        function loadCache() {
            try {
                const cached = localStorage.getItem('mtgPriceCache');
                if (cached) {
                    const data = JSON.parse(cached);
                    const now = Date.now();
                    const maxAge = 24 * 60 * 60 * 1000; // 24 hours
                    
                    // Filter out expired entries
                    for (const [key, entry] of Object.entries(data)) {
                        if (now - entry.timestamp < maxAge) {
                            priceCache[key] = entry;
                        }
                    }
                }
            } catch (e) {
                console.error('Failed to load cache:', e);
            }
        }

        // Save cache to localStorage
        function saveCache() {
            try {
                localStorage.setItem('mtgPriceCache', JSON.stringify(priceCache));
            } catch (e) {
                console.error('Failed to save cache:', e);
            }
        }

        // Get cached price (for Scryfall)
        function getCachedPrice(cardName, source) {
            const key = `${source}:${cardName.toLowerCase().trim()}`;
            const entry = priceCache[key];
            if (entry) {
                const now = Date.now();
                const maxAge = 24 * 60 * 60 * 1000;
                if (now - entry.timestamp < maxAge) {
                    return entry.price;
                }
            }
            return null;
        }

        // Cache a price
        function cachePrice(cardName, price, source) {
            const key = `${source}:${cardName.toLowerCase().trim()}`;
            priceCache[key] = {
                price: price,
                timestamp: Date.now()
            };
            saveCache();
        }

        // Load Card Kingdom pricelist
        async function loadCKPricelist() {
            if (ckPricelist !== null) {
                return true;
            }
            
            try {
                updateStatus('Loading Card Kingdom pricelist...');
                const response = await fetch('data/ck_pricelist.json');
                if (!response.ok) {
                    throw new Error('Failed to load pricelist');
                }
                const data = await response.json();
                ckPricelist = {};
                ckPricelistUpdated = data.updated;
                
                // Build lookup index with normalized names
                for (const [name, price] of Object.entries(data.prices)) {
                    const normalizedKey = normalizeName(name);
                    ckPricelist[normalizedKey] = { name, price };
                }
                
                console.log(`Loaded ${Object.keys(ckPricelist).length} Card Kingdom prices`);
                return true;
            } catch (e) {
                console.error('Failed to load CK pricelist:', e);
                updateStatus('Failed to load Card Kingdom pricelist. Try TCGPlayer instead.', true);
                return false;
            }
        }

        // Look up price in Card Kingdom pricelist
        function lookupCKPrice(cardName) {
            const normalized = normalizeName(cardName);
            const entry = ckPricelist[normalized];
            
            if (entry) {
                return {
                    name: entry.name,
                    price: entry.price,
                    cached: true
                };
            }
            
            // Try without the back face for double-faced cards
            if (cardName.includes(' // ')) {
                const frontFace = cardName.split(' // ')[0];
                const normalizedFront = normalizeName(frontFace);
                const frontEntry = ckPricelist[normalizedFront];
                if (frontEntry) {
                    return {
                        name: frontEntry.name,
                        price: frontEntry.price,
                        cached: true
                    };
                }
            }
            
            return {
                name: cardName,
                price: null,
                error: 'Not found in Card Kingdom'
            };
        }

        // Fetch price from Scryfall
        async function fetchScryfallPrice(cardName) {
            // Check cache first
            const cached = getCachedPrice(cardName, 'tcgplayer');
            if (cached !== null) {
                return { name: cardName, price: cached, cached: true };
            }

            try {
                const response = await fetch(
                    `https://api.scryfall.com/cards/named?fuzzy=${encodeURIComponent(cardName)}`
                );
                
                if (!response.ok) {
                    return { name: cardName, price: null, error: 'Not found' };
                }

                const data = await response.json();
                const price = data.prices?.usd ? parseFloat(data.prices.usd) : null;
                
                if (price !== null) {
                    cachePrice(cardName, price, 'tcgplayer');
                }

                return {
                    name: data.name,
                    price: price,
                    error: price === null ? 'No price available' : null
                };
            } catch (e) {
                return { name: cardName, price: null, error: e.message };
            }
        }

        // Sleep helper
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Process all cards
        async function processCards() {
            const input = document.getElementById('inputCards').value;
            const threshold = parseFloat(document.getElementById('threshold').value) || 1.00;
            const source = document.getElementById('source').value;
            currentSource = source;
            
            const cards = input.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);

            if (cards.length === 0) {
                updateStatus('Please enter at least one card name', true);
                return;
            }

            // Load Card Kingdom pricelist if needed
            if (source === 'cardkingdom') {
                const loaded = await loadCKPricelist();
                if (!loaded) {
                    return;
                }
            }

            // Reset state
            results = { below: [], above: [], notFound: [], all: [] };
            document.getElementById('sortBtn').disabled = true;
            document.getElementById('progressBar').classList.add('active');
            document.getElementById('stats').style.display = 'none';

            const progressFill = document.getElementById('progressFill');
            let processed = 0;

            for (const card of cards) {
                updateStatus(`Looking up: ${card} (${processed + 1}/${cards.length})`);
                
                let result;
                if (source === 'cardkingdom') {
                    result = lookupCKPrice(card);
                } else {
                    result = await fetchScryfallPrice(card);
                }
                
                results.all.push(result);

                if (result.price !== null) {
                    if (result.price < threshold) {
                        results.below.push(result);
                    } else {
                        results.above.push(result);
                    }
                } else {
                    // Cards without prices go to "not found" list
                    results.notFound.push(result);
                }

                processed++;
                progressFill.style.width = `${(processed / cards.length) * 100}%`;

                // Rate limiting for Scryfall - only delay if not cached
                if (source === 'tcgplayer' && !result.cached && processed < cards.length) {
                    await sleep(100);
                }
            }

            // Sort by price
            results.below.sort((a, b) => (b.price || 0) - (a.price || 0));
            results.above.sort((a, b) => (b.price || 0) - (a.price || 0));

            // Update UI
            updateStats(threshold);
            updateOutput();
            updateStatus(`Processed ${cards.length} cards`);
            
            document.getElementById('sortBtn').disabled = false;
            document.getElementById('progressBar').classList.remove('active');
            document.getElementById('stats').style.display = 'grid';
        }

        // Update statistics display
        function updateStats(threshold) {
            const belowTotal = results.below.reduce((sum, c) => sum + (c.price || 0), 0);
            const grandTotal = results.all.reduce((sum, c) => sum + (c.price || 0), 0);

            document.getElementById('totalCards').textContent = results.all.length;
            document.getElementById('belowTotal').textContent = `$${belowTotal.toFixed(2)}`;
            document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
            document.getElementById('belowCount').textContent = results.below.length;
            document.getElementById('aboveCount').textContent = results.above.length;
            document.getElementById('notFoundCount').textContent = results.notFound.length;
        }

        // Get source display name
        function getSourceName() {
            return currentSource === 'cardkingdom' ? 'Card Kingdom' : 'TCGPlayer (via Scryfall)';
        }

        // Update output textarea based on current tab
        function updateOutput() {
            const output = document.getElementById('outputCards');
            
            if (currentTab === 'below') {
                output.value = results.below.map(c => `1 ${c.name}`).join('\n');
            } else if (currentTab === 'above') {
                output.value = results.above.map(c => `1 ${c.name}`).join('\n');
            } else if (currentTab === 'notfound') {
                output.value = results.notFound.map(c => `${c.name}${c.error ? ` (${c.error})` : ''}`).join('\n');
            } else if (currentTab === 'summary') {
                const threshold = parseFloat(document.getElementById('threshold').value) || 1.00;
                const belowTotal = results.below.reduce((sum, c) => sum + (c.price || 0), 0);
                const aboveTotal = results.above.reduce((sum, c) => sum + (c.price || 0), 0);
                const grandTotal = belowTotal + aboveTotal;
                
                let summary = `MTG Card Price Summary\n`;
                summary += `======================\n\n`;
                summary += `Price Source: ${getSourceName()}\n`;
                if (currentSource === 'cardkingdom' && ckPricelistUpdated) {
                    summary += `Prices Updated: ${new Date(ckPricelistUpdated).toLocaleDateString()}\n`;
                }
                summary += `Threshold: $${threshold.toFixed(2)}\n`;
                summary += `Date: ${new Date().toLocaleDateString()}\n\n`;
                summary += `BELOW $${threshold.toFixed(2)}: ${results.below.length} cards - $${belowTotal.toFixed(2)}\n`;
                summary += `AT/ABOVE $${threshold.toFixed(2)}: ${results.above.length} cards - $${aboveTotal.toFixed(2)}\n`;
                summary += `NOT FOUND: ${results.notFound.length} cards\n`;
                summary += `GRAND TOTAL: $${grandTotal.toFixed(2)}\n\n`;
                summary += `--- BELOW THRESHOLD ---\n`;
                results.below.forEach(c => {
                    summary += `$${(c.price || 0).toFixed(2).padStart(7)} | ${c.name}\n`;
                });
                summary += `\n--- AT/ABOVE THRESHOLD ---\n`;
                results.above.forEach(c => {
                    summary += `$${c.price.toFixed(2).padStart(7)} | ${c.name}\n`;
                });
                if (results.notFound.length > 0) {
                    summary += `\n--- NOT FOUND ---\n`;
                    results.notFound.forEach(c => {
                        summary += `${c.name}${c.error ? ` (${c.error})` : ''}\n`;
                    });
                }
                
                output.value = summary;
            }
        }

        // Switch output tab
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });
            updateOutput();
        }

        // Update status message
        function updateStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.classList.toggle('error', isError);
        }

        // Copy output to clipboard
        function copyOutput() {
            const output = document.getElementById('outputCards');
            output.select();
            document.execCommand('copy');
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = originalText, 1500);
        }

        // Load sample cards
        function loadSample() {
            document.getElementById('inputCards').value = `Lightning Bolt
Counterspell
Sol Ring
Swords to Plowshares
Birds of Paradise
Llanowar Elves
Dark Ritual
Brainstorm
Path to Exile
Cultivate`;
        }

        // Update builder link visibility based on selected source
        function updateBuilderLink() {
            const source = document.getElementById('source').value;
            const tcgLink = document.getElementById('tcgBuilderLink');
            const ckLink = document.getElementById('ckBuilderLink');
            
            tcgLink.style.display = source === 'tcgplayer' ? 'inline-flex' : 'none';
            ckLink.style.display = source === 'cardkingdom' ? 'inline-flex' : 'none';
        }

        // Initialize
        loadCache();
        updateBuilderLink();
    </script>
</body>
</html>
